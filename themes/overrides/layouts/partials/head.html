<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

{{- if hugo.IsProduction | or (eq site.Params.env "production") | and (ne .Params.robotsNoIndex true) }}
<meta name="robots" content="index, follow">
{{- else }}
<meta name="robots" content="noindex, nofollow">
{{- end }}

{{- /* Title */}}
<title>{{ if .IsHome }}{{ else }}{{ if .Title }}{{ .Title }} | {{ end }}{{ end }}{{ site.Title }}</title>

{{- /* Meta */}}
{{- if .IsHome }}
  {{ with site.Params.keywords -}}
    <meta name="keywords" content="{{- range $i, $e := . }}{{ if $i }}, {{ end }}{{ $e }}{{ end }}">
  {{ end }}
{{- else }}
  <meta name="keywords" content="{{ if .Params.keywords -}}
      {{- range $i, $e := .Params.keywords }}{{ if $i }}, {{ end }}{{ $e }}{{ end }}  
    {{- else -}}
      {{- range $i, $e := .Params.tags }}{{ if $i }}, {{ end }}{{ $e }}{{ end }}
    {{- end -}}">
{{- end }}
<meta name="description" content="{{- with .Description }}{{ . }}{{- else }}{{- if or .IsPage .IsSection }}{{ .Summary | default (printf "%s â€“ %s" .Title site.Title) }}{{- else }}{{ with site.Params.description }}{{ . }}{{ end }}{{ end }}{{ end -}}">
<meta name="author" content="{{ partial "author.html" . }}">
<link rel="canonical" href="{{ if .Params.canonicalURL }}{{ .Params.canonicalURL | trim }}{{ else }}{{ .Permalink }}{{ end }}">

{{- if site.Params.analytics.google.SiteVerificationTag }}
  <meta name="google-site-verification" content="{{ site.Params.analytics.google.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.yandex.SiteVerificationTag }}
  <meta name="yandex-verification" content="{{ site.Params.analytics.yandex.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.bing.SiteVerificationTag }}
  <meta name="msvalidate.01" content="{{ site.Params.analytics.bing.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.naver.SiteVerificationTag }}
  <meta name="naver-site-verification" content="{{ site.Params.analytics.naver.SiteVerificationTag }}">
{{- end }}

{{- /* Styles */}}
{{- $includes := slice }}
{{- $blank := resources.FromString "assets/css/includes-blank.css" "" }}
{{- $includes = append $includes $blank }}
{{- if not site.Params.assets.disableScrollBarStyle }}
  {{- $scrollStyle := resources.Get "css/includes/scroll-bar.css" }}
  {{- $includes = append $includes $scrollStyle }}
{{- end }}
{{- $includesAll := $includes | resources.Concat "assets/css/includes.css" }}
{{- $themeVars := resources.Get "css/core/theme-vars.css" }}
{{- $reset := resources.Get "css/core/reset.css" }}
{{- $mediaCss := resources.Get "css/core/zmedia.css" }}
{{- $licenseCss := resources.Get "css/core/license.css" }}
{{- $commonCss := (resources.Match "css/common/*.css") | resources.Concat "assets/css/common.css" }}
{{- $chromaStyles := resources.Get "css/includes/chroma-styles.css" }}
{{- $chromaMod := resources.Get "css/includes/chroma-mod.css" }}
{{- $core := (slice $themeVars $reset $commonCss $chromaStyles $chromaMod $includesAll $mediaCss) | resources.Concat "assets/css/core.css" | resources.Minify }}
{{- $extendedCss := (resources.Match "css/extended/*.css") | resources.Concat "assets/css/extended.css" | resources.Minify }}
{{- $stylesheet := (slice $licenseCss $core $extendedCss) | resources.Concat "assets/css/stylesheet.css" }}
{{- if not site.Params.assets.disableFingerprinting }}
  {{- $stylesheet = $stylesheet | fingerprint }}
  <link rel="preload stylesheet" as="style" crossorigin="anonymous" href="{{ $stylesheet.RelPermalink }}" integrity="{{ $stylesheet.Data.Integrity }}">
{{- else }}
  <link rel="preload stylesheet" as="style" crossorigin="anonymous" href="{{ $stylesheet.RelPermalink }}">
{{- end }}

{{- /* Taxonomy badge CSS */}}
{{ partial "taxonomy-badges.html" . }}

{{- /* Search page */}}
{{- if eq .Layout "search" }}
  <link rel="preload" as="fetch" href="../index.json" crossorigin="anonymous">
  {{- $fastsearch := resources.Get "js/fastsearch.js" | js.Build (dict "params" (dict "fuseOpts" site.Params.fuseOpts)) | resources.Minify }}
  {{- $fusejs := resources.Get "js/fuse.basic.min.js" }}
  {{- $licenseJs := resources.Get "js/license.js" }}
  {{- if not site.Params.assets.disableFingerprinting }}
    {{- $searchJs := (slice $fusejs $licenseJs $fastsearch) | resources.Concat "assets/js/search.js" | fingerprint }}
    <script defer crossorigin="anonymous" src="{{ $searchJs.RelPermalink }}" integrity="{{ $searchJs.Data.Integrity }}"></script>
  {{- else }}
    {{- $searchJs := (slice $fusejs $fastsearch) | resources.Concat "assets/js/search.js" }}
    <script defer crossorigin="anonymous" src="{{ $searchJs.RelPermalink }}"></script>
  {{- end }}
{{- end }}

{{- /* Favicons */}}
<link rel="icon" href="{{ site.Params.assets.favicon | default "favicon.ico" | absURL }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ site.Params.assets.favicon16x16 | default "favicon-16x16.png" | absURL }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ site.Params.assets.favicon32x32 | default "favicon-32x32.png" | absURL }}">
<link rel="apple-touch-icon" href="{{ site.Params.assets.apple_touch_icon | default "apple-touch-icon.png" | absURL }}">
<link rel="mask-icon" href="{{ site.Params.assets.safari_pinned_tab | default "safari-pinned-tab.svg" | absURL }}">
<meta name="theme-color" content="{{ site.Params.assets.theme_color | default "#2e2e33" }}">
<meta name="msapplication-TileColor" content="{{ site.Params.assets.msapplication_TileColor | default "#2e2e33" }}">

{{- /* RSS / alternate languages */}}
{{ range .AlternativeOutputFormats }}
  <link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink }}">
{{- end }}
{{- range .AllTranslations }}
  <link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}">
{{- end }}

<noscript>
  <style>
    #theme-toggle,
    .top-link { display: none; }
  </style>
  {{- if and (ne site.Params.defaultTheme "light") (ne site.Params.defaultTheme "dark") }}
    <style>
      @media (prefers-color-scheme: dark) {
        /* dark-mode vars... */
      }
    </style>
  {{- end }}
</noscript>

{{ partial "extend_head.html" . }}

{{- /* Analytics & Social Previews */}}
{{- if hugo.IsProduction | or (eq site.Params.env "production") }}
  {{ partial "google_analytics.html" . }}

  {{- /* Capture the first <img> src from your post content */ -}}
  {{- $firstImg := replaceRE `(?is).*<img[^>]+src="([^"]+)".*` "${1}" .Content }}

  {{- if $firstImg }}
    <meta property="og:image" content="{{ $firstImg }}">
    <meta name="twitter:image" content="{{ $firstImg }}">
  {{- end }}

  {{ partial "templates/opengraph.html" . | safeHTML }}
  {{ partial "templates/twitter_cards.html" . }}
{{- end }}
